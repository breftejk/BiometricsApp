<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:BiometricsApp.UI.ViewModels"
        xmlns:controls="using:BiometricsApp.UI.Controls"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d" d:DesignWidth="1600" d:DesignHeight="1000"
        x:Class="BiometricsApp.UI.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Icon="/Assets/avalonia-logo.ico"
        Title="Biometrics Studio - Image Processing Suite"
        Width="1600" Height="1000"
        MinWidth="1200" MinHeight="800"
        Background="#FFFFFF"
        SystemDecorations="Full"
        ExtendClientAreaToDecorationsHint="False">

    <Design.DataContext>
        <vm:MainWindowViewModel/>
    </Design.DataContext>

    <Window.Styles>
        <Style Selector="Button.primary">
            <Setter Property="Background" Value="#0078D4"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Padding" Value="16,10"/>
            <Setter Property="CornerRadius" Value="4"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Cursor" Value="Hand"/>
        </Style>
        <Style Selector="Button.primary:pointerover">
            <Setter Property="Background" Value="#106EBE"/>
        </Style>
        <Style Selector="Button.primary:pressed">
            <Setter Property="Background" Value="#005A9E"/>
        </Style>
        
        <Style Selector="Button.secondary">
            <Setter Property="Background" Value="#F3F2F1"/>
            <Setter Property="Foreground" Value="#323130"/>
            <Setter Property="BorderBrush" Value="#8A8886"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="16,10"/>
            <Setter Property="CornerRadius" Value="4"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Cursor" Value="Hand"/>
        </Style>
        <Style Selector="Button.secondary:pointerover">
            <Setter Property="Background" Value="#E1DFDD"/>
        </Style>
        
        <Style Selector="Button.success">
            <Setter Property="Background" Value="#107C10"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Padding" Value="16,10"/>
            <Setter Property="CornerRadius" Value="4"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Cursor" Value="Hand"/>
        </Style>
        <Style Selector="Button.success:pointerover">
            <Setter Property="Background" Value="#0E6B0E"/>
        </Style>
        
        <Style Selector="Button.danger">
            <Setter Property="Background" Value="#D13438"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Padding" Value="16,10"/>
            <Setter Property="CornerRadius" Value="4"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Cursor" Value="Hand"/>
        </Style>
        
        <Style Selector="TextBlock.title">
            <Setter Property="FontSize" Value="24"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Foreground" Value="#323130"/>
        </Style>
        
        <Style Selector="TextBlock.subtitle">
            <Setter Property="FontSize" Value="18"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Foreground" Value="#323130"/>
        </Style>
        
        <Style Selector="TextBlock.label">
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Foreground" Value="#605E5C"/>
        </Style>
        
        <Style Selector="TextBlock.caption">
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Foreground" Value="#8A8886"/>
        </Style>
    </Window.Styles>

    <Grid RowDefinitions="Auto,Auto,*,Auto">
        
        <!-- Application Header -->
        <Border Grid.Row="0" Background="#0078D4" Padding="20,16">
            <Grid ColumnDefinitions="Auto,*">
                <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="12" VerticalAlignment="Center">
                    <Viewbox Width="32" Height="32">
                        <Canvas Width="24" Height="24">
                            <Path Fill="White" Data="M12,2L2,7V17C2,21.4 5.6,25 12,25C18.4,25 22,21.4 22,17V7L12,2M12,4.4L19,8.3V17C19,19.8 16.8,22 12,22C7.2,22 5,19.8 5,17V8.3L12,4.4M12,11A2,2 0 0,1 14,13A2,2 0 0,1 12,15A2,2 0 0,1 10,13A2,2 0 0,1 12,11Z"/>
                        </Canvas>
                    </Viewbox>
                    <StackPanel Spacing="2">
                        <TextBlock Text="Biometrics Studio" 
                                  FontSize="18" 
                                  FontWeight="SemiBold" 
                                  Foreground="White"/>
                        <TextBlock Text="Image Processing Suite" 
                                  FontSize="11" 
                                  Foreground="#FFFFFF99"
                                  Opacity="0.8"/>
                    </StackPanel>
                </StackPanel>
                
                <Border Grid.Column="1"
                        Background="#00000020" 
                        CornerRadius="12" 
                        Padding="10,6"
                        HorizontalAlignment="Right"
                        VerticalAlignment="Center"
                        IsVisible="{Binding IsProcessing}">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <ProgressBar IsIndeterminate="True"
                                    Width="100"
                                    Height="3"
                                    VerticalAlignment="Center"
                                    Foreground="White"/>
                        <TextBlock Text="Processing..." 
                                  FontSize="12" 
                                  Foreground="White"
                                  VerticalAlignment="Center"/>
                    </StackPanel>
                </Border>
            </Grid>
        </Border>

        <!-- Ribbon Toolbar -->
        <Border Grid.Row="1" Background="#F3F2F1" BorderBrush="#EDEBE9" BorderThickness="0,0,0,1">
            <Grid Margin="20,12">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="16"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="16"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <!-- File Group -->
                <StackPanel Grid.Column="0">
                    <TextBlock Text="FILE" Classes="caption" Margin="0,0,0,6"/>
                    <StackPanel Orientation="Horizontal" Spacing="6">
                        <Button Command="{Binding LoadImageCommand}" Classes="success">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <Viewbox Width="16" Height="16">
                                    <Canvas Width="24" Height="24">
                                        <Path Fill="White" Data="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20M12,19L8,15H10.5V12H13.5V15H16L12,19Z"/>
                                    </Canvas>
                                </Viewbox>
                                <TextBlock Text="Open" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                        
                        <Button Command="{Binding SaveImageCommand}"
                                Classes="primary"
                                IsEnabled="{Binding ProcessedImage, Converter={x:Static ObjectConverters.IsNotNull}}">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <Viewbox Width="16" Height="16">
                                    <Canvas Width="24" Height="24">
                                        <Path Fill="White" Data="M15,9H5V5H15M12,19A3,3 0 0,1 9,16A3,3 0 0,1 12,13A3,3 0 0,1 15,16A3,3 0 0,1 12,19M17,3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V7L17,3Z"/>
                                    </Canvas>
                                </Viewbox>
                                <TextBlock Text="Save" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                    </StackPanel>
                </StackPanel>
                
                <Separator Grid.Column="1" Width="1" Background="#EDEBE9"/>
                
                <!-- Edit Group -->
                <StackPanel Grid.Column="2">
                    <TextBlock Text="EDIT" Classes="caption" Margin="0,0,0,6"/>
                    <StackPanel Orientation="Horizontal" Spacing="6">
                        <Button Command="{Binding UndoCommand}"
                                Classes="secondary">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <Viewbox Width="16" Height="16">
                                    <Canvas Width="24" Height="24">
                                        <Path Fill="#323130" Data="M12.5,8C9.85,8 7.45,9 5.6,10.6L2,7V16H11L7.38,12.38C8.77,11.22 10.54,10.5 12.5,10.5C16.04,10.5 19.05,12.81 20.1,16L22.47,15.22C21.08,11.03 17.15,8 12.5,8Z"/>
                                    </Canvas>
                                </Viewbox>
                                <TextBlock Text="Undo" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                        
                        <Button Command="{Binding ResetImageCommand}"
                                Classes="secondary"
                                IsEnabled="{Binding ProcessedImage, Converter={x:Static ObjectConverters.IsNotNull}}">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <Viewbox Width="16" Height="16">
                                    <Canvas Width="24" Height="24">
                                        <Path Fill="#323130" Data="M12,4C14.1,4 16.1,4.8 17.6,6.3C20.7,9.4 20.7,14.5 17.6,17.6C15.8,19.5 13.3,20.2 10.9,19.9L11.4,17.9C13.1,18.1 14.9,17.5 16.2,16.2C18.5,13.9 18.5,10.1 16.2,7.7C15.1,6.6 13.5,6 12,6V10.6L7,5.6L12,0.6V4M6.3,17.6C3.7,15 3.3,11 5.1,7.9L6.6,9.4C5.5,11.6 5.9,14.4 7.8,16.2C8.3,16.7 8.9,17.1 9.6,17.4L9,19.4C8,19 7.1,18.4 6.3,17.6Z"/>
                                    </Canvas>
                                </Viewbox>
                                <TextBlock Text="Reset" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                    </StackPanel>
                </StackPanel>
                
                <Separator Grid.Column="3" Width="1" Background="#EDEBE9"/>
                
                <!-- Process Group -->
                <StackPanel Grid.Column="4">
                    <TextBlock Text="PROCESS" Classes="caption" Margin="0,0,0,6"/>
                    <Button Command="{Binding ApplyOperationCommand}"
                            Classes="primary"
                            IsEnabled="{Binding OriginalImage, Converter={x:Static ObjectConverters.IsNotNull}}">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <Viewbox Width="16" Height="16">
                                <Canvas Width="24" Height="24">
                                    <Path Fill="White" Data="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4M11,6V12L15.5,14.5L16.5,12.9L13,11V6H11Z"/>
                                </Canvas>
                            </Viewbox>
                            <TextBlock Text="Apply Operation" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                </StackPanel>
                
                <!-- Status -->
                <TextBlock Grid.Column="6" 
                          Text="{Binding StatusText}"
                          Classes="label"
                          VerticalAlignment="Center"
                          Margin="20,0,0,0"/>
            </Grid>
        </Border>

        <!-- Main Content Area -->
        <Grid Grid.Row="2" ColumnDefinitions="*,Auto,380" Margin="20">
            
            <!-- Center - Images -->
            <Grid Grid.Column="0" RowDefinitions="*,16,*">
                
                <!-- Original Image -->
                <Border Grid.Row="0" 
                        Background="White" 
                        BorderBrush="#EDEBE9" 
                        BorderThickness="1"
                        CornerRadius="4"
                        Padding="16">
                    <controls:ImageWithHistogram 
                        Title="Original Image"
                        ImageSource="{Binding OriginalImage}"
                        HistogramRed="{Binding HistogramRedOriginal}"
                        HistogramGreen="{Binding HistogramGreenOriginal}"
                        HistogramBlue="{Binding HistogramBlueOriginal}"
                        HistogramAverage="{Binding HistogramAverageOriginal}"/>
                </Border>

                <!-- Processed Image -->
                <Border Grid.Row="2" 
                        Background="White" 
                        BorderBrush="#EDEBE9" 
                        BorderThickness="1"
                        CornerRadius="4"
                        Padding="16"
                        IsVisible="{Binding ProcessedImage, Converter={x:Static ObjectConverters.IsNotNull}}">
                    <controls:ImageWithHistogram 
                        Title="Processed Image"
                        ImageSource="{Binding ProcessedImage}"
                        HistogramRed="{Binding HistogramRedProcessed}"
                        HistogramGreen="{Binding HistogramGreenProcessed}"
                        HistogramBlue="{Binding HistogramBlueProcessed}"
                        HistogramAverage="{Binding HistogramAverageProcessed}"/>
                </Border>
                
                <!-- Placeholder when no processed image -->
                <Border Grid.Row="2" 
                        Background="#FAFAFA" 
                        BorderBrush="#EDEBE9" 
                        BorderThickness="2"
                        CornerRadius="4"
                        IsVisible="{Binding ProcessedImage, Converter={x:Static ObjectConverters.IsNull}}">
                    <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center" Spacing="12">
                        <Viewbox Width="64" Height="64" Opacity="0.3">
                            <Canvas Width="24" Height="24">
                                <Path Fill="#8A8886" Data="M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z"/>
                            </Canvas>
                        </Viewbox>
                        <TextBlock Text="Processed image will appear here" 
                                  Classes="caption"
                                  HorizontalAlignment="Center"/>
                        <TextBlock Text="Apply an operation to see results" 
                                  FontSize="11"
                                  Foreground="#C8C6C4"
                                  HorizontalAlignment="Center"/>
                    </StackPanel>
                </Border>
            </Grid>

            <GridSplitter Grid.Column="1" 
                         Width="1" 
                         Background="#EDEBE9"
                         Margin="16,0"/>

            <!-- Right Sidebar - Operations Panel -->
            <Border Grid.Column="2" 
                    Background="White" 
                    BorderBrush="#EDEBE9" 
                    BorderThickness="1"
                    CornerRadius="4">
                <Grid RowDefinitions="Auto,*">
                    <!-- Header -->
                    <Border Grid.Row="0" 
                            Background="#F3F2F1" 
                            BorderBrush="#EDEBE9"
                            BorderThickness="0,0,0,1"
                            Padding="20,16">
                        <TextBlock Text="Operations" Classes="subtitle"/>
                    </Border>

                    <!-- Content -->
                    <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                        <StackPanel Spacing="20" Margin="20">
                            
                            <!-- Operation Selection -->
                            <StackPanel Spacing="10">
                                <TextBlock Text="Select Operation" Classes="label"/>
                                <ComboBox ItemsSource="{Binding Operations}"
                                         SelectedItem="{Binding SelectedOperation}"
                                         HorizontalAlignment="Stretch"
                                         Padding="12,10"
                                         FontSize="14"/>
                            </StackPanel>

                            <Separator Background="#EDEBE9"/>

                            <!-- Operation Parameters -->
                            <!-- Threshold Binarization -->
                            <StackPanel Spacing="12" 
                                       IsVisible="{Binding SelectedOperation, Converter={x:Static ObjectConverters.Equal}, ConverterParameter='Threshold Binarization'}">
                                <TextBlock Text="Threshold Binarization" Classes="subtitle" FontSize="16"/>
                                
                                <StackPanel Spacing="8">
                                    <Grid ColumnDefinitions="*,Auto">
                                        <TextBlock Grid.Column="0" Text="Threshold" Classes="label"/>
                                        <Border Grid.Column="1" 
                                                Background="#0078D4" 
                                                CornerRadius="2" 
                                                Padding="8,4"
                                                MinWidth="50">
                                            <TextBlock Text="{Binding BinarizationThreshold}" 
                                                      FontWeight="Bold"
                                                      FontSize="13"
                                                      Foreground="White"
                                                      HorizontalAlignment="Center"/>
                                        </Border>
                                    </Grid>
                                    <Slider Minimum="0" 
                                           Maximum="255" 
                                           Value="{Binding BinarizationThreshold}"
                                           TickFrequency="1"
                                           IsSnapToTickEnabled="True"
                                           Foreground="#0078D4"/>
                                </StackPanel>

                                <StackPanel Spacing="8">
                                    <TextBlock Text="Channel" Classes="label"/>
                                    <ComboBox ItemsSource="{Binding Channels}"
                                             SelectedItem="{Binding SelectedChannel}"
                                             HorizontalAlignment="Stretch"
                                             Padding="10,8"/>
                                </StackPanel>
                            </StackPanel>

                            <!-- Otsu Binarization -->
                            <StackPanel Spacing="12"
                                       IsVisible="{Binding SelectedOperation, Converter={x:Static ObjectConverters.Equal}, ConverterParameter='Otsu Binarization'}">
                                <TextBlock Text="Otsu Binarization" Classes="subtitle" FontSize="16"/>
                                <TextBlock Text="Automatic threshold selection using Otsu's method"
                                          Classes="caption"
                                          TextWrapping="Wrap"/>
                                
                                <StackPanel Spacing="8">
                                    <TextBlock Text="Channel" Classes="label"/>
                                    <ComboBox ItemsSource="{Binding Channels}"
                                             SelectedItem="{Binding SelectedChannel}"
                                             HorizontalAlignment="Stretch"
                                             Padding="10,8"/>
                                </StackPanel>

                                <Border Background="#E8F4FD" 
                                        BorderBrush="#0078D4"
                                        BorderThickness="1"
                                        CornerRadius="3"
                                        Padding="12"
                                        IsVisible="{Binding OtsuThreshold, Converter={x:Static ObjectConverters.NotEqual}, ConverterParameter=128}">
                                    <StackPanel Spacing="4">
                                        <TextBlock Text="Calculated Threshold:" 
                                                  FontSize="11"
                                                  Foreground="#323130"/>
                                        <TextBlock Text="{Binding OtsuThreshold}" 
                                                  FontSize="20"
                                                  FontWeight="Bold"
                                                  Foreground="#0078D4"/>
                                    </StackPanel>
                                </Border>
                            </StackPanel>

                            <!-- Niblack Binarization -->
                            <StackPanel Spacing="12"
                                       IsVisible="{Binding SelectedOperation, Converter={x:Static ObjectConverters.Equal}, ConverterParameter='Niblack Binarization'}">
                                <TextBlock Text="Niblack Binarization" Classes="subtitle" FontSize="16"/>
                                <TextBlock Text="Local adaptive binarization based on mean and standard deviation"
                                          Classes="caption"
                                          TextWrapping="Wrap"/>
                                
                                <StackPanel Spacing="8">
                                    <Grid ColumnDefinitions="*,Auto">
                                        <TextBlock Grid.Column="0" Text="K Parameter" Classes="label"/>
                                        <TextBlock Grid.Column="1" 
                                                  Text="{Binding NiblackK, StringFormat='{}{0:F2}'}" 
                                                  FontWeight="SemiBold"
                                                  Foreground="#0078D4"/>
                                    </Grid>
                                    <Slider Minimum="-1.0" 
                                           Maximum="0.5" 
                                           Value="{Binding NiblackK}"
                                           TickFrequency="0.1"
                                           Foreground="#0078D4"/>
                                </StackPanel>

                                <StackPanel Spacing="8">
                                    <Grid ColumnDefinitions="*,Auto">
                                        <TextBlock Grid.Column="0" Text="Window Size" Classes="label"/>
                                        <TextBlock Grid.Column="1" 
                                                  Text="{Binding NiblackWindowSize}" 
                                                  FontWeight="SemiBold"
                                                  Foreground="#0078D4"/>
                                    </Grid>
                                    <Slider Minimum="3" 
                                           Maximum="51" 
                                           Value="{Binding NiblackWindowSize}"
                                           TickFrequency="2"
                                           IsSnapToTickEnabled="True"
                                           Foreground="#0078D4"/>
                                </StackPanel>
                            </StackPanel>

                            <!-- Sauvola Binarization -->
                            <StackPanel Spacing="12"
                                       IsVisible="{Binding SelectedOperation, Converter={x:Static ObjectConverters.Equal}, ConverterParameter='Sauvola Binarization'}">
                                <TextBlock Text="Sauvola Binarization" Classes="subtitle" FontSize="16"/>
                                <TextBlock Text="Improved Niblack method for document images"
                                          Classes="caption"
                                          TextWrapping="Wrap"/>
                                
                                <StackPanel Spacing="8">
                                    <Grid ColumnDefinitions="*,Auto">
                                        <TextBlock Grid.Column="0" Text="K Parameter" Classes="label"/>
                                        <TextBlock Grid.Column="1" 
                                                  Text="{Binding SauvolaK, StringFormat='{}{0:F2}'}" 
                                                  FontWeight="SemiBold"
                                                  Foreground="#0078D4"/>
                                    </Grid>
                                    <Slider Minimum="0.0" 
                                           Maximum="1.0" 
                                           Value="{Binding SauvolaK}"
                                           TickFrequency="0.05"
                                           Foreground="#0078D4"/>
                                </StackPanel>

                                <StackPanel Spacing="8">
                                    <Grid ColumnDefinitions="*,Auto">
                                        <TextBlock Grid.Column="0" Text="Window Size" Classes="label"/>
                                        <TextBlock Grid.Column="1" 
                                                  Text="{Binding SauvolaWindowSize}" 
                                                  FontWeight="SemiBold"
                                                  Foreground="#0078D4"/>
                                    </Grid>
                                    <Slider Minimum="3" 
                                           Maximum="51" 
                                           Value="{Binding SauvolaWindowSize}"
                                           TickFrequency="2"
                                           IsSnapToTickEnabled="True"
                                           Foreground="#0078D4"/>
                                </StackPanel>
                            </StackPanel>

                            <!-- Phansalkar Binarization -->
                            <StackPanel Spacing="12"
                                       IsVisible="{Binding SelectedOperation, Converter={x:Static ObjectConverters.Equal}, ConverterParameter='Phansalkar Binarization'}">
                                <TextBlock Text="Phansalkar Binarization" Classes="subtitle" FontSize="16"/>
                                <TextBlock Text="Advanced method for low contrast images"
                                          Classes="caption"
                                          TextWrapping="Wrap"/>
                                
                                <StackPanel Spacing="8">
                                    <Grid ColumnDefinitions="*,Auto">
                                        <TextBlock Grid.Column="0" Text="K Parameter" Classes="label"/>
                                        <TextBlock Grid.Column="1" 
                                                  Text="{Binding PhansalkarK, StringFormat='{}{0:F2}'}" 
                                                  FontWeight="SemiBold"
                                                  Foreground="#0078D4"/>
                                    </Grid>
                                    <Slider Minimum="0.0" 
                                           Maximum="1.0" 
                                           Value="{Binding PhansalkarK}"
                                           TickFrequency="0.05"
                                           Foreground="#0078D4"/>
                                </StackPanel>

                                <StackPanel Spacing="8">
                                    <Grid ColumnDefinitions="*,Auto">
                                        <TextBlock Grid.Column="0" Text="Window Size" Classes="label"/>
                                        <TextBlock Grid.Column="1" 
                                                  Text="{Binding PhansalkarWindowSize}" 
                                                  FontWeight="SemiBold"
                                                  Foreground="#0078D4"/>
                                    </Grid>
                                    <Slider Minimum="3" 
                                           Maximum="51" 
                                           Value="{Binding PhansalkarWindowSize}"
                                           TickFrequency="2"
                                           IsSnapToTickEnabled="True"
                                           Foreground="#0078D4"/>
                                </StackPanel>
                            </StackPanel>

                            <!-- Kapur Binarization -->
                            <StackPanel Spacing="12"
                                       IsVisible="{Binding SelectedOperation, Converter={x:Static ObjectConverters.Equal}, ConverterParameter='Kapur Binarization'}">
                                <TextBlock Text="Kapur Binarization" Classes="subtitle" FontSize="16"/>
                                <TextBlock Text="Entropy-based automatic threshold selection"
                                          Classes="caption"
                                          TextWrapping="Wrap"/>
                                
                                <Border Background="#F3F2F1" 
                                        CornerRadius="3"
                                        Padding="12">
                                    <TextBlock Text="No parameters required. Uses maximum entropy criterion for optimal threshold."
                                              FontSize="12"
                                              Foreground="#605E5C"
                                              TextWrapping="Wrap"/>
                                </Border>

                                <Border Background="#E8F4FD" 
                                        BorderBrush="#0078D4"
                                        BorderThickness="1"
                                        CornerRadius="3"
                                        Padding="12"
                                        IsVisible="{Binding KapurThreshold, Converter={x:Static ObjectConverters.NotEqual}, ConverterParameter=128}">
                                    <StackPanel Spacing="4">
                                        <TextBlock Text="Calculated Threshold:" 
                                                  FontSize="11"
                                                  Foreground="#323130"/>
                                        <TextBlock Text="{Binding KapurThreshold}" 
                                                  FontSize="20"
                                                  FontWeight="Bold"
                                                  Foreground="#0078D4"/>
                                    </StackPanel>
                                </Border>
                            </StackPanel>

                            <!-- Li-Wu Binarization -->
                            <StackPanel Spacing="12"
                                       IsVisible="{Binding SelectedOperation, Converter={x:Static ObjectConverters.Equal}, ConverterParameter='Li-Wu Binarization'}">
                                <TextBlock Text="Li-Wu Binarization" Classes="subtitle" FontSize="16"/>
                                <TextBlock Text="Minimum cross entropy threshold selection"
                                          Classes="caption"
                                          TextWrapping="Wrap"/>
                                
                                <Border Background="#F3F2F1" 
                                        CornerRadius="3"
                                        Padding="12">
                                    <TextBlock Text="No parameters required. Uses minimum cross entropy criterion."
                                              FontSize="12"
                                              Foreground="#605E5C"
                                              TextWrapping="Wrap"/>
                                </Border>

                                <Border Background="#E8F4FD" 
                                        BorderBrush="#0078D4"
                                        BorderThickness="1"
                                        CornerRadius="3"
                                        Padding="12"
                                        IsVisible="{Binding LiWuThreshold, Converter={x:Static ObjectConverters.NotEqual}, ConverterParameter=128}">
                                    <StackPanel Spacing="4">
                                        <TextBlock Text="Calculated Threshold:" 
                                                  FontSize="11"
                                                  Foreground="#323130"/>
                                        <TextBlock Text="{Binding LiWuThreshold}" 
                                                  FontSize="20"
                                                  FontWeight="Bold"
                                                  Foreground="#0078D4"/>
                                    </StackPanel>
                                </Border>
                            </StackPanel>

                            <!-- Bernsen Binarization -->
                            <StackPanel Spacing="12"
                                       IsVisible="{Binding SelectedOperation, Converter={x:Static ObjectConverters.Equal}, ConverterParameter='Bernsen Binarization'}">
                                <TextBlock Text="Bernsen Binarization" Classes="subtitle" FontSize="16"/>
                                <TextBlock Text="Local contrast-based binarization"
                                          Classes="caption"
                                          TextWrapping="Wrap"/>
                                
                                <StackPanel Spacing="8">
                                    <Grid ColumnDefinitions="*,Auto">
                                        <TextBlock Grid.Column="0" Text="Window Size" Classes="label"/>
                                        <TextBlock Grid.Column="1" 
                                                  Text="{Binding BernsenWindowSize}" 
                                                  FontWeight="SemiBold"
                                                  Foreground="#0078D4"/>
                                    </Grid>
                                    <Slider Minimum="3" 
                                           Maximum="101" 
                                           Value="{Binding BernsenWindowSize}"
                                           TickFrequency="2"
                                           IsSnapToTickEnabled="True"
                                           Foreground="#0078D4"/>
                                </StackPanel>

                                <StackPanel Spacing="8">
                                    <Grid ColumnDefinitions="*,Auto">
                                        <TextBlock Grid.Column="0" Text="Contrast Threshold" Classes="label"/>
                                        <TextBlock Grid.Column="1" 
                                                  Text="{Binding BernsenContrastThreshold}" 
                                                  FontWeight="SemiBold"
                                                  Foreground="#0078D4"/>
                                    </Grid>
                                    <Slider Minimum="0" 
                                           Maximum="100" 
                                           Value="{Binding BernsenContrastThreshold}"
                                           TickFrequency="5"
                                           IsSnapToTickEnabled="True"
                                           Foreground="#0078D4"/>
                                </StackPanel>
                            </StackPanel>

                            <!-- Adaptive Gradient Binarization -->
                            <StackPanel Spacing="12"
                                       IsVisible="{Binding SelectedOperation, Converter={x:Static ObjectConverters.Equal}, ConverterParameter='Adaptive Gradient Binarization'}">
                                <TextBlock Text="Adaptive Gradient Binarization" Classes="subtitle" FontSize="16"/>
                                <TextBlock Text="Custom algorithm combining gradient information with adaptive thresholding"
                                          Classes="caption"
                                          TextWrapping="Wrap"/>
                                
                                <StackPanel Spacing="8">
                                    <Grid ColumnDefinitions="*,Auto">
                                        <TextBlock Grid.Column="0" Text="Window Size" Classes="label"/>
                                        <TextBlock Grid.Column="1" 
                                                  Text="{Binding AdaptiveGradientWindowSize}" 
                                                  FontWeight="SemiBold"
                                                  Foreground="#0078D4"/>
                                    </Grid>
                                    <Slider Minimum="3" 
                                           Maximum="51" 
                                           Value="{Binding AdaptiveGradientWindowSize}"
                                           TickFrequency="2"
                                           IsSnapToTickEnabled="True"
                                           Foreground="#0078D4"/>
                                </StackPanel>

                                <StackPanel Spacing="8">
                                    <Grid ColumnDefinitions="*,Auto">
                                        <TextBlock Grid.Column="0" Text="Gradient Weight" Classes="label"/>
                                        <TextBlock Grid.Column="1" 
                                                  Text="{Binding AdaptiveGradientWeight, StringFormat='{}{0:F2}'}" 
                                                  FontWeight="SemiBold"
                                                  Foreground="#0078D4"/>
                                    </Grid>
                                    <Slider Minimum="0.0" 
                                           Maximum="1.0" 
                                           Value="{Binding AdaptiveGradientWeight}"
                                           TickFrequency="0.05"
                                           Foreground="#0078D4"/>
                                </StackPanel>

                                <Border Background="#E8F4FD" 
                                        BorderBrush="#0078D4"
                                        BorderThickness="1"
                                        CornerRadius="3"
                                        Padding="12">
                                    <StackPanel Spacing="4">
                                        <TextBlock Text="âœ¨ Custom Algorithm" 
                                                  FontSize="11"
                                                  FontWeight="SemiBold"
                                                  Foreground="#0078D4"/>
                                        <TextBlock Text="This algorithm uses Sobel edge detection combined with adaptive local thresholding to preserve edges better."
                                                  FontSize="11"
                                                  Foreground="#323130"
                                                  TextWrapping="Wrap"/>
                                    </StackPanel>
                                </Border>
                            </StackPanel>

                            <!-- Convolution Filter -->
                            <StackPanel Spacing="12"
                                       IsVisible="{Binding SelectedOperation, Converter={x:Static ObjectConverters.Equal}, ConverterParameter='Convolution Filter'}">
                                <TextBlock Text="Convolution Filter" Classes="subtitle" FontSize="16"/>
                                <TextBlock Text="Linear filters based on convolution operation"
                                          Classes="caption"
                                          TextWrapping="Wrap"/>
                                
                                <StackPanel Spacing="8">
                                    <TextBlock Text="Kernel Type" Classes="label"/>
                                    <ComboBox ItemsSource="{Binding ConvolutionKernels}"
                                             SelectedItem="{Binding SelectedConvolutionKernel}"
                                             HorizontalAlignment="Stretch"
                                             Padding="12,10"/>
                                </StackPanel>

                                <Border Background="#E8F4FD" 
                                        BorderBrush="#0078D4"
                                        BorderThickness="1"
                                        CornerRadius="3"
                                        Padding="12">
                                    <StackPanel Spacing="4">
                                        <TextBlock Text="ðŸ“‹ Kernel Info" 
                                                  FontSize="11"
                                                  FontWeight="SemiBold"
                                                  Foreground="#0078D4"/>
                                        <TextBlock Text="Choose from various convolution kernels: Gaussian blur for smoothing, Prewitt/Sobel for edge detection, Laplacian for feature enhancement, and more."
                                                  FontSize="11"
                                                  Foreground="#323130"
                                                  TextWrapping="Wrap"/>
                                    </StackPanel>
                                </Border>
                            </StackPanel>

                            <!-- Median Filter -->
                            <StackPanel Spacing="12"
                                       IsVisible="{Binding SelectedOperation, Converter={x:Static ObjectConverters.Equal}, ConverterParameter='Median Filter'}">
                                <TextBlock Text="Median Filter" Classes="subtitle" FontSize="16"/>
                                <TextBlock Text="Non-linear filter for noise reduction with edge preservation"
                                          Classes="caption"
                                          TextWrapping="Wrap"/>
                                
                                <StackPanel Spacing="8">
                                    <Grid ColumnDefinitions="*,Auto">
                                        <TextBlock Grid.Column="0" Text="Window Size" Classes="label"/>
                                        <Border Grid.Column="1" 
                                                Background="#0078D4" 
                                                CornerRadius="2" 
                                                Padding="8,4"
                                                MinWidth="50">
                                            <TextBlock Text="{Binding MedianFilterSize}" 
                                                      FontWeight="Bold"
                                                      FontSize="13"
                                                      Foreground="White"
                                                      HorizontalAlignment="Center"/>
                                        </Border>
                                    </Grid>
                                    <Slider Minimum="3" 
                                           Maximum="21" 
                                           Value="{Binding MedianFilterSize}"
                                           TickFrequency="2"
                                           IsSnapToTickEnabled="True"
                                           Foreground="#0078D4"/>
                                    <TextBlock Text="ðŸ’¡ Larger windows remove more noise but may blur edges"
                                              Classes="caption"
                                              TextWrapping="Wrap"
                                              Margin="0,4,0,0"/>
                                </StackPanel>
                            </StackPanel>

                            <!-- Pixelization -->
                            <StackPanel Spacing="12"
                                       IsVisible="{Binding SelectedOperation, Converter={x:Static ObjectConverters.Equal}, ConverterParameter='Pixelization'}">
                                <TextBlock Text="Pixelization" Classes="subtitle" FontSize="16"/>
                                <TextBlock Text="Create a mosaic/pixelated effect"
                                          Classes="caption"
                                          TextWrapping="Wrap"/>
                                
                                <StackPanel Spacing="8">
                                    <Grid ColumnDefinitions="*,Auto">
                                        <TextBlock Grid.Column="0" Text="Pixel Block Size" Classes="label"/>
                                        <Border Grid.Column="1" 
                                                Background="#0078D4" 
                                                CornerRadius="2" 
                                                Padding="8,4"
                                                MinWidth="50">
                                            <TextBlock Text="{Binding PixelizationSize}" 
                                                      FontWeight="Bold"
                                                      FontSize="13"
                                                      Foreground="White"
                                                      HorizontalAlignment="Center"/>
                                        </Border>
                                    </Grid>
                                    <Slider Minimum="2" 
                                           Maximum="50" 
                                           Value="{Binding PixelizationSize}"
                                           TickFrequency="1"
                                           IsSnapToTickEnabled="True"
                                           Foreground="#0078D4"/>
                                    <Grid ColumnDefinitions="*,*,*">
                                        <TextBlock Grid.Column="0" Text="Fine" Classes="caption" HorizontalAlignment="Left"/>
                                        <TextBlock Grid.Column="1" Text="10" Classes="caption" HorizontalAlignment="Center"/>
                                        <TextBlock Grid.Column="2" Text="Blocky" Classes="caption" HorizontalAlignment="Right"/>
                                    </Grid>
                                </StackPanel>
                            </StackPanel>

                            <!-- Kuwahara Filter -->
                            <StackPanel Spacing="12"
                                       IsVisible="{Binding SelectedOperation, Converter={x:Static ObjectConverters.Equal}, ConverterParameter='Kuwahara Filter'}">
                                <TextBlock Text="Kuwahara Filter" Classes="subtitle" FontSize="16"/>
                                <TextBlock Text="Edge-preserving smoothing filter (painting-like effect)"
                                          Classes="caption"
                                          TextWrapping="Wrap"/>
                                
                                <StackPanel Spacing="8">
                                    <Grid ColumnDefinitions="*,Auto">
                                        <TextBlock Grid.Column="0" Text="Window Size" Classes="label"/>
                                        <Border Grid.Column="1" 
                                                Background="#0078D4" 
                                                CornerRadius="2" 
                                                Padding="8,4"
                                                MinWidth="50">
                                            <TextBlock Text="{Binding KuwaharaWindowSize}" 
                                                      FontWeight="Bold"
                                                      FontSize="13"
                                                      Foreground="White"
                                                      HorizontalAlignment="Center"/>
                                        </Border>
                                    </Grid>
                                    <Slider Minimum="3" 
                                           Maximum="15" 
                                           Value="{Binding KuwaharaWindowSize}"
                                           TickFrequency="2"
                                           IsSnapToTickEnabled="True"
                                           Foreground="#0078D4"/>
                                </StackPanel>

                                <Border Background="#E8F4FD" 
                                        BorderBrush="#0078D4"
                                        BorderThickness="1"
                                        CornerRadius="3"
                                        Padding="12">
                                    <StackPanel Spacing="4">
                                        <TextBlock Text="ðŸŽ¨ Artistic Effect" 
                                                  FontSize="11"
                                                  FontWeight="SemiBold"
                                                  Foreground="#0078D4"/>
                                        <TextBlock Text="Smooths regions while preserving edges, creating a painting-like effect. Great for artistic processing."
                                                  FontSize="11"
                                                  Foreground="#323130"
                                                  TextWrapping="Wrap"/>
                                    </StackPanel>
                                </Border>
                            </StackPanel>

                            <!-- Predator Filter -->
                            <StackPanel Spacing="12"
                                       IsVisible="{Binding SelectedOperation, Converter={x:Static ObjectConverters.Equal}, ConverterParameter='Predator Filter'}">
                                <TextBlock Text="Predator Filter ðŸ‘¾" Classes="subtitle" FontSize="16"/>
                                <TextBlock Text="Thermal/Predator vision effect (Pixelization + MinRGB + Sobel)"
                                          Classes="caption"
                                          TextWrapping="Wrap"/>
                                
                                <StackPanel Spacing="8">
                                    <Grid ColumnDefinitions="*,Auto">
                                        <TextBlock Grid.Column="0" Text="Pixel Size" Classes="label"/>
                                        <Border Grid.Column="1" 
                                                Background="#0078D4" 
                                                CornerRadius="2" 
                                                Padding="8,4"
                                                MinWidth="50">
                                            <TextBlock Text="{Binding PredatorPixelSize}" 
                                                      FontWeight="Bold"
                                                      FontSize="13"
                                                      Foreground="White"
                                                      HorizontalAlignment="Center"/>
                                        </Border>
                                    </Grid>
                                    <Slider Minimum="2" 
                                           Maximum="30" 
                                           Value="{Binding PredatorPixelSize}"
                                           TickFrequency="1"
                                           IsSnapToTickEnabled="True"
                                           Foreground="#0078D4"/>
                                </StackPanel>

                                <StackPanel Spacing="8">
                                    <CheckBox IsChecked="{Binding PredatorColorGrade}"
                                             Content="Apply Thermal Color Grading"
                                             FontSize="14"
                                             FontWeight="SemiBold"/>
                                    <TextBlock Text="Adds heat-map colors (blue â†’ green â†’ yellow â†’ red)"
                                              Classes="caption"
                                              Margin="28,0,0,0"/>
                                </StackPanel>

                                <Border Background="#1E1E1E" 
                                        BorderBrush="#00FF00"
                                        BorderThickness="2"
                                        CornerRadius="3"
                                        Padding="12">
                                    <StackPanel Spacing="4">
                                        <TextBlock Text="ðŸ‘¾ BONUS ALGORITHM" 
                                                  FontSize="11"
                                                  FontWeight="Bold"
                                                  Foreground="#00FF00"/>
                                        <TextBlock Text="Combines: Pixelization â†’ MinRGB â†’ Sobel Edge Detection"
                                                  FontSize="11"
                                                  Foreground="#CCCCCC"
                                                  TextWrapping="Wrap"/>
                                    </StackPanel>
                                </Border>
                            </StackPanel>

                            <!-- Histogram Stretching -->
                            <StackPanel Spacing="12"
                                       IsVisible="{Binding SelectedOperation, Converter={x:Static ObjectConverters.Equal}, ConverterParameter='Histogram Stretching'}">
                                <TextBlock Text="Histogram Stretching" Classes="subtitle" FontSize="16"/>
                                <TextBlock Text="Stretch histogram to specified range"
                                          Classes="caption"
                                          TextWrapping="Wrap"/>
                                
                                <StackPanel Spacing="8">
                                    <Grid ColumnDefinitions="*,Auto">
                                        <TextBlock Grid.Column="0" Text="Minimum Output" Classes="label"/>
                                        <TextBlock Grid.Column="1" 
                                                  Text="{Binding StretchMin}" 
                                                  FontWeight="SemiBold"
                                                  Foreground="#0078D4"/>
                                    </Grid>
                                    <Slider Minimum="0" 
                                           Maximum="255" 
                                           Value="{Binding StretchMin}"
                                           TickFrequency="1"
                                           IsSnapToTickEnabled="True"
                                           Foreground="#0078D4"/>
                                </StackPanel>

                                <StackPanel Spacing="8">
                                    <Grid ColumnDefinitions="*,Auto">
                                        <TextBlock Grid.Column="0" Text="Maximum Output" Classes="label"/>
                                        <TextBlock Grid.Column="1" 
                                                  Text="{Binding StretchMax}" 
                                                  FontWeight="SemiBold"
                                                  Foreground="#0078D4"/>
                                    </Grid>
                                    <Slider Minimum="0" 
                                           Maximum="255" 
                                           Value="{Binding StretchMax}"
                                           TickFrequency="1"
                                           IsSnapToTickEnabled="True"
                                           Foreground="#0078D4"/>
                                </StackPanel>
                            </StackPanel>

                            <!-- Histogram Equalization -->
                            <StackPanel Spacing="12"
                                       IsVisible="{Binding SelectedOperation, Converter={x:Static ObjectConverters.Equal}, ConverterParameter='Histogram Equalization'}">
                                <TextBlock Text="Histogram Equalization" Classes="subtitle" FontSize="16"/>
                                <TextBlock Text="Equalize histogram to improve contrast"
                                          Classes="caption"
                                          TextWrapping="Wrap"/>
                                <Border Background="#F3F2F1" 
                                        CornerRadius="3"
                                        Padding="12">
                                    <TextBlock Text="No parameters required. This operation will automatically distribute pixel intensities across the full range."
                                              FontSize="12"
                                              Foreground="#605E5C"
                                              TextWrapping="Wrap"/>
                                </Border>
                            </StackPanel>

                            <!-- Brightness Adjustment -->
                            <StackPanel Spacing="12"
                                       IsVisible="{Binding SelectedOperation, Converter={x:Static ObjectConverters.Equal}, ConverterParameter='Brightness Adjustment'}">
                                <TextBlock Text="Brightness Adjustment" Classes="subtitle" FontSize="16"/>
                                
                                <StackPanel Spacing="8">
                                    <Grid ColumnDefinitions="*,Auto">
                                        <TextBlock Grid.Column="0" Text="Brightness" Classes="label"/>
                                        <Border Grid.Column="1" 
                                                Background="#0078D4" 
                                                CornerRadius="2" 
                                                Padding="8,4"
                                                MinWidth="50">
                                            <TextBlock Text="{Binding BrightnessValue}" 
                                                      FontWeight="Bold"
                                                      FontSize="13"
                                                      Foreground="White"
                                                      HorizontalAlignment="Center"/>
                                        </Border>
                                    </Grid>
                                    <Slider Minimum="-255" 
                                           Maximum="255" 
                                           Value="{Binding BrightnessValue}"
                                           TickFrequency="1"
                                           IsSnapToTickEnabled="True"
                                           Foreground="#0078D4"/>
                                    <Grid ColumnDefinitions="*,*,*">
                                        <TextBlock Grid.Column="0" Text="Darker" Classes="caption" HorizontalAlignment="Left"/>
                                        <TextBlock Grid.Column="1" Text="0" Classes="caption" HorizontalAlignment="Center"/>
                                        <TextBlock Grid.Column="2" Text="Brighter" Classes="caption" HorizontalAlignment="Right"/>
                                    </Grid>
                                </StackPanel>
                            </StackPanel>

                            <!-- Contrast Adjustment -->
                            <StackPanel Spacing="12"
                                       IsVisible="{Binding SelectedOperation, Converter={x:Static ObjectConverters.Equal}, ConverterParameter='Contrast Adjustment'}">
                                <TextBlock Text="Contrast Adjustment" Classes="subtitle" FontSize="16"/>
                                
                                <StackPanel Spacing="8">
                                    <Grid ColumnDefinitions="*,Auto">
                                        <TextBlock Grid.Column="0" Text="Contrast" Classes="label"/>
                                        <Border Grid.Column="1" 
                                                Background="#0078D4" 
                                                CornerRadius="2" 
                                                Padding="8,4"
                                                MinWidth="50">
                                            <TextBlock Text="{Binding ContrastValue, StringFormat='{}{0:F2}'}" 
                                                      FontWeight="Bold"
                                                      FontSize="13"
                                                      Foreground="White"
                                                      HorizontalAlignment="Center"/>
                                        </Border>
                                    </Grid>
                                    <Slider Minimum="0" 
                                           Maximum="3" 
                                           Value="{Binding ContrastValue}"
                                           TickFrequency="0.1"
                                           Foreground="#0078D4"/>
                                    <Grid ColumnDefinitions="*,*,*">
                                        <TextBlock Grid.Column="0" Text="Lower" Classes="caption" HorizontalAlignment="Left"/>
                                        <TextBlock Grid.Column="1" Text="Normal (1.0)" Classes="caption" HorizontalAlignment="Center"/>
                                        <TextBlock Grid.Column="2" Text="Higher" Classes="caption" HorizontalAlignment="Right"/>
                                    </Grid>
                                </StackPanel>
                            </StackPanel>

                        </StackPanel>
                    </ScrollViewer>
                </Grid>
            </Border>
        </Grid>

        <!-- Footer Status Bar -->
        <Border Grid.Row="3" 
                Background="#F3F2F1" 
                BorderBrush="#EDEBE9" 
                BorderThickness="0,1,0,0"
                Padding="20,10">
            <Grid ColumnDefinitions="Auto,*,Auto">
                <TextBlock Grid.Column="0" 
                          Text="Biometrics Studio" 
                          Classes="caption"
                          VerticalAlignment="Center"/>
                
                <TextBlock Grid.Column="2" 
                          Text="{Binding StatusText}"
                          Classes="caption"
                          VerticalAlignment="Center"/>
            </Grid>
        </Border>
    </Grid>

</Window>
